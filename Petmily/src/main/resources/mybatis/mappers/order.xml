<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.petmily.dao.OrderDAO">

	<insert id="insertOrder" parameterType="order">
	<![CDATA[
		insert into petmily.order (order_num,user_id,prod_num,order_status,order_count,order_date) 
		values(#{order_num},#{user_id},#{prod_num},#{order_status},#{order_count},now())
	]]>
	</insert>

	<select id="selectMaxOrderNum" resultType="integer">
		<![CDATA[
			select max(order_num) from petmily.order
		]]>
	</select>


	<update id="mem_payment">
		<![CDATA[
		update product set 
		prod_amount = case when prod_amount > 0 then prod_amount-1 else prod_amount end,
		prod_amount = case when prod_amount < 0 then prod_amount-1 else prod_amount end,
	 	remain_amount = case when prod_amount < 0 then remain_amount+1 else remain_amount end,
   		prod_${mem_grade}=prod_${mem_grade}+1
   		where prod_num=#{fix1} or prod_num=#{fix2} or prod_num=#{fix3}
		]]>
	</update>

	<!--주문 내역 조회 -->
	<select id="orderDetail" resultType="order" parameterType="String">
		select p.prod_name, p.prod_price, o.user_id,
		o.order_date, o.order_num, o.order_count
		from petmily.order o, product p
		where o.user_id = #{user_id}
	</select>

</mapper>
